---
title: Sessions
description: "Create and manage persistent sessions with cookie storage."
---

## createSession()

Create a persistent session context for related requests.

Within a session, `browser`, `os`, and `proxy` are fixed at creation time (unless you pass an explicit [`transport`](/api-reference/transport) per request).

### Signature

```typescript
function createSession(options?: CreateSessionOptions): Promise<Session>
```

### Options

<ParamField path="browser" type="BrowserProfile">
  Default browser fingerprint profile for all session requests.
</ParamField>

<ParamField path="os" type="EmulationOS">
  Default operating system to emulate.
</ParamField>

<ParamField path="proxy" type="string">
  Default proxy URL for all session requests.
</ParamField>

<ParamField path="timeout" type="number" default="30000">
  Default request timeout in milliseconds.
</ParamField>

<ParamField path="insecure" type="boolean" default="false">
  Accept invalid certificates for all session requests. **Use only in development.**
</ParamField>

### Session object

The returned `Session` object has:

#### session.fetch(url, init?)

Make a request using the session context.

```typescript
const response = await session.fetch('https://example.com/api', {
  method: 'POST',
  body: JSON.stringify({ data: 'value' }),
});
```

Per-request options override session defaults.

#### session.websocket(url, options?)

Open a WebSocket that reuses the session transport and context.

Use this after login or any other HTTP flow that sets cookies.

```typescript
const ws = await session.websocket('wss://example.com/ws', {
  headers: {
    Authorization: 'Bearer token',
  },
});

ws.onmessage = (event) => {
  console.log(event.data);
};

ws.close();
```

`session.websocket(...)` accepts `headers`, `protocols`, and `binaryType`.

It does not accept `browser`, `os`, or `proxy` because those are owned by the session transport.

`protocols` values are validated for non empty unique entries and sent in the `Sec-WebSocket-Protocol` handshake header.

#### session.close()

Close the session and release resources. Always call this when done.

```typescript
await session.close();
```

### Example

```typescript
import { createSession } from 'wreq-js';

const session = await createSession({
  browser: 'chrome_142',
  os: 'windows',
});

// Login in the same session context
await session.fetch('https://example.com/login', {
  method: 'POST',
  body: new URLSearchParams({ user: 'name', pass: 'secret' }),
});

// Subsequent requests use the same session context
const profile = await session.fetch('https://example.com/profile');
console.log(await profile.json());

// Always close when done
await session.close();
```

---

## withSession()

Auto-disposing session helper that closes the session when the callback completes.

### Signature

```typescript
function withSession<T>(
  callback: (session: Session) => Promise<T>,
  options?: CreateSessionOptions
): Promise<T>
```

### Example

```typescript
import { withSession } from 'wreq-js';

const result = await withSession(async (session) => {
  await session.fetch('https://example.com/login', {
    method: 'POST',
    body: 'credentials',
  });
  
  const response = await session.fetch('https://example.com/data');
  return response.json();
}, {
  browser: 'chrome_142',
});

// Session is automatically closed
console.log(result);
```

### With options

```typescript
const data = await withSession(
  async (session) => {
    const response = await session.fetch('https://example.com/api');
    return response.json();
  },
  {
    browser: 'firefox_139',
    proxy: 'http://proxy.example.com:8080',
  }
);
```

---

## Session vs. Ephemeral

| Feature | Ephemeral (default `fetch`) | Session |
| ------- | --------------------------- | ------- |
| Cookies | Separate request context | Shared session context |
| Transport settings | Request scoped | Session scoped unless overridden by transport |
| Use case | Isolated requests | Multi-step flows |
